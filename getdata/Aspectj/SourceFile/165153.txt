@@ -10,9 +10,13 @@
  *******************************************************************************/
 package org.aspectj.weaver.tools;
 
+import java.io.PrintStream;
+
+
 public class DefaultTrace extends AbstractTrace {
 
-	private boolean traceEnabled = false; 
+	private boolean traceEnabled = false;
+	private PrintStream print = System.err;
 
 	public DefaultTrace (Class clazz) {
 		super(clazz);
@@ -98,7 +102,11 @@ public class DefaultTrace extends AbstractTrace {
 	 * @param s message to be traced
 	 */
 	protected void println (String s) {
-		System.err.println(s);
+		print.println(s);
+	}
+
+	public void setPrintStream (PrintStream printStream) {
+		this.print = printStream;
 	}
 
 //	private static boolean isTracingEnabled = getBoolean("org.aspectj.weaver.tools.tracing",false);
@@ -10,12 +10,32 @@
  *******************************************************************************/
 package org.aspectj.weaver.tools;
 
+import java.io.File;
+import java.io.FileOutputStream;
+import java.io.IOException;
+import java.io.PrintStream;
+
 public class DefaultTraceFactory extends TraceFactory {
 
 	public final static String ENABLED_PROPERTY = "org.aspectj.tracing.enabled";
+	public final static String FILE_PROPERTY = "org.aspectj.tracing.file";
 
     private boolean tracingEnabled = getBoolean(ENABLED_PROPERTY,false);
+    private PrintStream print;
 
+    public DefaultTraceFactory() {
+		String filename = System.getProperty(FILE_PROPERTY);
+		if (filename != null) {
+			File file = new File(filename);
+			try {
+				print = new PrintStream(new FileOutputStream(file));
+			}
+			catch (IOException ex) {
+	    		if (debug) ex.printStackTrace();
+			}
+		}
+	}
+    
     public boolean isEnabled() {
 		return tracingEnabled;
 	}
@@ -23,6 +43,7 @@ public class DefaultTraceFactory extends TraceFactory {
     public Trace getTrace (Class clazz) {
     	DefaultTrace trace = new DefaultTrace(clazz);
     	trace.setTraceEnabled(tracingEnabled);
+    	if (print != null) trace.setPrintStream(print);
     	return trace;
     }
 
@@ -18,7 +18,7 @@ public abstract class TraceFactory {
 	public final static String FACTORY_PROPERTY = "org.aspectj.tracing.factory";
 	public final static String DEFAULT_FACTORY_NAME = "default";
 
-    private static boolean debug = getBoolean(DEBUG_PROPERTY,false); 
+    protected static boolean debug = getBoolean(DEBUG_PROPERTY,false); 
     private static TraceFactory instance;
 
     public Trace getTrace (Class clazz) {
@@ -29,4 +29,9 @@ public class DefaultTraceTest extends AbstractTraceTest {
 		trace.setTraceEnabled(true);
 		assertTrue(trace.isTraceEnabled());
 	}
+	
+	public void testSetPrintStream () {
+		DefaultTrace trace = new DefaultTrace(getClass());
+		trace.setPrintStream(System.out);
+	}
 }
@@ -45,5 +45,13 @@ public class TracingTests extends org.aspectj.testing.XMLBasedAjcTestCase {
 	public void testJDK14Tracing_pr159854 () {
   		runTest("JDK 1.4 tracing");
 	}
+	
+	public void testTracingFileSystemProperty () {
+  		runTest("Tracing file System Property");
+
+  		File dir = getSandboxDirectory();
+  		File file = new File(dir,"tracing.txt");
+        assertTrue("Missing tracing file: " + file,file.exists());
+	}
 
 }
@@ -84,4 +84,16 @@
             </stdout>
         </ant>
     </ajc-test>
+
+	<ajc-test dir="tracing" title="Tracing file System Property" keywords="tracing">
+        <compile
+        	files="HelloWorld.java"
+        />
+        <compile files="Aspect.aj" options="-outxml"/>
+		<ant file="ant.xml" target="Tracing file System Property" verbose="true">
+        	<stdout>
+                <line text="Hello World!"/>
+            </stdout>
+        </ant>
+    </ajc-test>
 </suite>
@@ -63,4 +63,18 @@
         </java>
     </target>
 
+    <target name="Tracing file System Property">
+        <java fork="yes" classname="HelloWorld" failonerror="yes">
+            <classpath refid="aj.path"/>
+            <jvmarg value="-Dorg.aspectj.tracing.enabled=true"/>
+            <jvmarg value="-Dorg.aspectj.tracing.factory=default"/>
+            <jvmarg value="-Dorg.aspectj.tracing.messages=true"/>
+        	<sysproperty key="org.aspectj.tracing.file" path="${aj.sandbox}/tracing.txt"/>
+<!--            <jvmarg value="-verbose:class"/>-->
+            <!-- use META-INF/aop.xml style -->
+            <jvmarg value="-javaagent:${aj.root}/lib/test/loadtime5.jar"/>
+<!--            <jvmarg line="${jdwp}"/>-->
+        </java>
+    </target>
+
 </project>
