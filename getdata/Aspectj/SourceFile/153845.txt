@@ -0,0 +1,2 @@
+import java.util.*;
+public aspect Aspect extends GenericType<Set<String>> {}
@@ -0,0 +1,3 @@
+public aspect Aspect2 {
+  declare parents: Aspect implements Interface;
+}
@@ -0,0 +1,2 @@
+public class GenericType<T> {
+}
@@ -0,0 +1 @@
+interface Interface {}
@@ -0,0 +1 @@
+public class Nothing {}
@@ -27,7 +27,8 @@ public class Ajc153Tests extends org.aspectj.testing.XMLBasedAjcTestCase {
   // public void testArgnamesAndJavac_pr148381() { runTest("argNames and javac");}
   // public void testCFlowXMLAspectLTW_pr149096() { runTest("cflow xml concrete aspect"); }
   // public void testAmbiguousBinding_pr121805() { runTest("ambiguous binding");}
-//  public void testNoIllegalStateExceptionWithGenericInnerAspect_pr156058() { runTest("no IllegalStateException with generic inner aspect"); }  
+//  public void testNoIllegalStateExceptionWithGenericInnerAspect_pr156058() { runTest("no IllegalStateException with generic inner aspect"); }
+  public void testIllegalStateExceptionGenerics_pr153845() { runTest("IllegalStateException at GenericSignatureParser.java"); }
   public void testNoIllegalStateExceptionFromAsmDelegate_pr153490_1() { runTest("no illegal state exception from AsmDelegate - 1");}
   public void testNoIllegalStateExceptionFromAsmDelegate_pr153490_2() { runTest("no illegal state exception from AsmDelegate - 2");}
   public void testNoIllegalStateExceptionFromAsmDelegate_pr153490_3() { runTest("no illegal state exception from AsmDelegate - 3");}
@@ -3,6 +3,11 @@
 <!-- AspectJ v1.5.3 Tests -->
 <suite>
 
+    <ajc-test dir="bugs153/pr153845" title="IllegalStateException at GenericSignatureParser.java">
+      <compile files="GenericType.java,Aspect.java,Aspect2.java,Interface.java" options="-1.5" outjar="blob.jar"/>
+      <compile files="Nothing.java" aspectpath="blob.jar" options="-1.5" outjar="bang.jar"/>
+    </ajc-test>
+
     <ajc-test dir="bugs153/pr156058" title="no IllegalStateException with generic inner aspect">
       <compile files="Bug.java" options="-1.5">
         <message kind="warning" line="2" text="advice defined in MyAspect has not been applied [Xlint:adviceDidNotMatch]"/>
@@ -714,7 +714,7 @@ public class ReferenceType extends ResolvedType {
 		ret.append(rawSig.substring(0,rawSig.length()-1));
 		ret.append("<");
 		for (int i = 0; i < someParameters.length; i++) {
-			ret.append(someParameters[i].getSignature());			
+			ret.append(((ReferenceType)someParameters[i]).getSignatureForAttribute());			
 		}
 		ret.append(">;");
 		return ret.toString();
